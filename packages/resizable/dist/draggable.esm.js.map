{"version":3,"file":"draggable.esm.js","sources":["../lib/utils/helpers.ts","../lib/utils/prefix.ts","../lib/utils/dom.ts","../lib/utils/positions.ts","../lib/DragCore.tsx","../lib/hooks/useReferenceState.ts","../lib/Draggable.tsx"],"sourcesContent":["export function find<T>(array: Array<T>, cb: (value: T, index: number) => void) {\n  if (!Array.isArray(array)) return undefined\n\n  for (let i = 0, { length } = array; i < length; i += 1) {\n    if (cb.apply(cb, [array[i], i, array])) return array[i]\n  }\n\n  return undefined\n}\n\nexport function isFunction(func: any) {\n  return typeof func === 'function' || Object.prototype.toString.call(func) === '[object Function]'\n}\n\nexport function isNum(number: number) {\n  return typeof number === 'number' && !Number.isNaN(number)\n}\n\nexport function int(number) {\n  return parseInt(number, 10)\n}\n\nexport function snapToGrid(grid: [number, number], pendingX: number, pendingY: number) {\n  const x = Math.round(pendingX / grid[0]) * grid[0]\n  const y = Math.round(pendingY / grid[1]) * grid[1]\n\n  return [x, y]\n}\n\nexport function canDragX(axis) {\n  return axis === 'both' || axis === 'x'\n}\n\nexport function canDragY(axis) {\n  return axis === 'both' || axis === 'y'\n}\n\nexport function log(...args) {\n  if (process.env.NODE_ENV === 'development') {\n    // eslint-disable-next-line\n    console.log(...args)\n  }\n}\n","const prefixes = ['Moz', 'Webkit', 'O', 'ms']\n\nfunction kebabToTitleCase(str: string) {\n  let value = ''\n  let shouldCapitalize = true\n  for (let i = 0; i <= str.length; i += 1) {\n    if (shouldCapitalize) {\n      value += value[i].toUpperCase()\n      shouldCapitalize = false\n    } else if (str[i] === '-') {\n      shouldCapitalize = true\n    } else {\n      value += str[i]\n    }\n  }\n\n  return value\n}\n\nexport function browserPrefixToKey(prop: string, prefix: string) {\n  return prefix ? `${prefix}${kebabToTitleCase(prop)}` : prop\n}\n\nexport function browserPrefixToStyle(prop: string, prefix: string) {\n  return prefix ? `${prefix.toLowerCase()}-${prop}` : prop\n}\n\nexport function getPrefix(prop = 'transform') {\n  if (typeof window === 'undefined' || typeof window.document === 'undefined') return ''\n\n  const { style } = window.document.documentElement\n\n  if (prop in style) return ''\n\n  for (let i = 0; i < prefixes.length; i += 1) {\n    if (browserPrefixToKey(prop, prefixes[i]) in style) {\n      return prefixes[i]\n    }\n  }\n\n  return ''\n}\n\nexport default getPrefix()\n","import { find, isFunction, int } from './helpers'\nimport { MouseTouchEvent, ControlPosition, OffsetPositionOfControl } from '../types'\nimport browserPrefix, { browserPrefixToKey } from './prefix'\n\nexport function addClass(el: HTMLElement, classname: string) {\n  if (el.classList) {\n    el.classList.add(classname)\n  } else if (!el.className.match(new RegExp(`(?:^|\\\\s)${classname}(?!\\\\S)`))) {\n    // eslint-disable-next-line no-param-reassign\n    el.className += `${classname}`\n  }\n}\n\nexport function removeClass(el: HTMLElement, classname: string) {\n  if (el.classList) {\n    el.classList.remove(classname)\n  } else {\n    // eslint-disable-next-line no-param-reassign\n    el.className = el.className.replace(new RegExp(`(?:^|\\\\s)${classname}(?!\\\\S)`, 'g'), '')\n  }\n}\n\nexport function addEvent(\n  el: Node,\n  event: string,\n  handler: EventListenerOrEventListenerObject,\n  inputOptions?: AddEventListenerOptions\n) {\n  if (!el) return\n  const options = { capture: true, ...inputOptions }\n  if (el.addEventListener) {\n    el.addEventListener(event, handler, options)\n    // @ts-ignore\n  } else if (el.attachEvent) {\n    // @ts-ignore\n    el.attachEvent(`on${event}`, handler)\n  } else {\n    // eslint-disable-next-line no-param-reassign\n    el[`on${event}`] = handler\n  }\n}\n\nexport function removeEvent(\n  el: Node,\n  event: string,\n  handler: EventListenerOrEventListenerObject,\n  inputOptions?: AddEventListenerOptions\n) {\n  if (!el) return\n  const options = { capture: true, ...inputOptions }\n  if (el.removeEventListener) {\n    el.removeEventListener(event, handler, options)\n    // @ts-ignore\n  } else if (el.detachEvent) {\n    // @ts-ignore\n    el.detachEvent(`on${event}`, handler)\n  } else {\n    // eslint-disable-next-line no-param-reassign\n    el[`on${event}`] = null\n  }\n}\n\nlet matchsSelectorFunc = ''\nexport function matchSelector(el: Node, selector: string) {\n  if (!matchsSelectorFunc) {\n    matchsSelectorFunc = find(\n      [\n        'matches',\n        'webkitMatchesSelector',\n        'mozMatchesSelector',\n        'msMatchesSelector',\n        'oMatchesSelector'\n      ],\n      (method) => isFunction(el[method])\n    )\n  }\n\n  if (!isFunction(el[matchsSelectorFunc])) return false\n  return el[matchsSelectorFunc](selector)\n}\n\nexport function matchSelectorAndParent(el: Node, selector: string, baseNode: Node) {\n  let node = el\n  do {\n    if (matchSelector(node, selector)) return true\n    if (node === baseNode) return false\n    node = node.parentNode\n  } while (node)\n\n  return false\n}\n\nexport function getTouch(e: MouseTouchEvent, indentifier: number) {\n  return (\n    (e.targetTouches && find<any>(e.targetTouches as any, (t) => indentifier === t.indentifier)) ||\n    (e.changedTouches && find<any>(e.changedTouches as any, (t) => indentifier === t.indentifier))\n  )\n}\n\nexport function getTouchIdentifier(e: MouseTouchEvent) {\n  if (e.targetTouches && e.targetTouches[0]) return e.targetTouches[0].identifier\n  if (e.changedTouches && e.changedTouches[0]) return e.changedTouches[0].identifier\n\n  return undefined\n}\n\nexport function offsetFromParent(\n  { clientX, clientY }: MouseTouchEvent,\n  offsetParent: Element,\n  scale: number\n) {\n  const isBody = offsetParent === offsetParent.ownerDocument.body\n  const rect = isBody ? { left: 0, top: 0 } : offsetParent.getBoundingClientRect()\n\n  const x = (clientX + offsetParent.scrollLeft - rect.left) / scale\n  const y = (clientY + offsetParent.scrollTop - rect.top) / scale\n\n  return { x, y }\n}\n\nexport function addUserSelectStyles(doc?: Document) {\n  if (!doc) return\n  let styleEl = doc.getElementById('draggable-style-el')\n  if (!styleEl) {\n    styleEl = doc.createElement('style')\n    styleEl.setAttribute('type', 'text/css')\n    styleEl.id = 'draggable-style-el'\n    styleEl.innerHTML = '.draggable-transparent-selection *::-moz-selection { all: inherit; }\\n'\n    styleEl.innerHTML = '.draggable-transparent-selection *::selection { all: inherit; }\\n'\n    doc.getElementsByTagName('head')[0].appendChild(styleEl)\n  }\n  if (doc.body) addClass(doc.body, 'draggable-transparent-selection')\n}\n\nexport function removeUserSelectStyle(doc?: Document) {\n  if (!doc) return\n  try {\n    if (doc.body) removeClass(doc.body, 'draggable-transparent-selection')\n    // @ts-ignore\n    if (doc.selection) {\n      // @ts-ignore\n      doc.getSelection.empty()\n    } else {\n      const selection = (doc.defaultView || window).getSelection()\n      if (selection && selection.type !== 'Caret') {\n        selection.removeAllRanges()\n      }\n    }\n    // eslint-disable-next-line no-empty\n  } catch (e) {}\n}\n\nexport function outerWidth(node: HTMLElement) {\n  let width = node.clientWidth\n  const computedStyle = node.ownerDocument.defaultView.getComputedStyle(node)\n  width += int(computedStyle.borderLeftWidth)\n  width += int(computedStyle.borderRightWidth)\n  return width\n}\n\nexport function outerHeight(node: HTMLElement) {\n  let height = node.clientHeight\n  const computedStyle = node.ownerDocument.defaultView.getComputedStyle(node)\n  height += int(computedStyle.borderTopWidth) + int(computedStyle.borderBottomWidth)\n  height += int(computedStyle.borderBottomWidth)\n  return height\n}\n\nexport function innerWidth(node: HTMLElement) {\n  let width = node.clientWidth\n  const computedStyle = node.ownerDocument.defaultView.getComputedStyle(node)\n  width -= int(computedStyle.paddingLeft)\n  width -= int(computedStyle.paddingRight)\n  return width\n}\n\nexport function innerHeight(node: HTMLElement) {\n  let height = node.clientHeight\n  const computedStyle = node.ownerDocument.defaultView.getComputedStyle(node)\n  height -= int(computedStyle.paddingTop)\n  height -= int(computedStyle.paddingBottom)\n  return height\n}\n\nexport function getTranslation(\n  { x, y }: ControlPosition,\n  positionOffset: OffsetPositionOfControl,\n  unit: string\n) {\n  let translation = `translate(${x}${unit}, ${y}${unit})`\n  if (positionOffset) {\n    const defaultX = `${\n      typeof positionOffset.x === 'string' ? positionOffset.x : `${positionOffset.x}${unit}`\n    }`\n    const defaultY = `${\n      typeof positionOffset.y === 'string' ? positionOffset.y : `${positionOffset.y}${unit}`\n    }`\n    translation = `translate(${defaultX}, ${defaultY})${translation}`\n  }\n\n  return translation\n}\n\nexport function createCSSTransform(\n  controlPos: ControlPosition,\n  positionOffset: OffsetPositionOfControl\n) {\n  const translation = getTranslation(controlPos, positionOffset, 'px')\n  return { [browserPrefixToKey('transform', browserPrefix)]: translation }\n}\n\nexport function createSVGTransform(\n  controlPos: ControlPosition,\n  positionOffset: OffsetPositionOfControl\n) {\n  const translation = getTranslation(controlPos, positionOffset, '')\n  return translation\n}\n","import { MutableRefObject } from 'react'\nimport { DraggableState, MouseTouchEvent, DraggableData, BoundsShape } from '../types'\nimport { getTouch, offsetFromParent, innerWidth, outerWidth, innerHeight, outerHeight } from './dom'\nimport { isNum, int } from './helpers'\n\nfunction cloneBounds(bounds: BoundsShape): BoundsShape {\n  return {\n    left: bounds.left,\n    right: bounds.right,\n    top: bounds.top,\n    bottom: bounds.bottom\n  }\n}\n\nexport function getBoundPosition(\n  node: HTMLElement,\n  bounds: BoundsShape | string | undefined,\n  x: number,\n  y: number\n): [number, number] {\n  if (!bounds) return [x, y]\n\n  let newX = x\n  let newY = y\n  let newBounds = typeof bounds === 'string' ? {} : cloneBounds(bounds)\n\n  if (typeof bounds === 'string') {\n    const { ownerDocument } = node\n    const ownerWindow = ownerDocument.defaultView\n    let boundNode\n    if (bounds === 'parent') {\n      boundNode = node.parentNode\n    } else {\n      boundNode = ownerDocument.querySelector(bounds)\n    }\n    if (!(boundNode instanceof ownerWindow.HTMLElement)) {\n      throw new Error(`Bounds selector \"${bounds}\" not exist.`)\n    }\n    const nodeStyle = ownerWindow.getComputedStyle(node)\n    const boundNodeStyle = ownerWindow.getComputedStyle(boundNode)\n\n    newBounds = {\n      left: -node.offsetLeft + int(boundNodeStyle.paddingLeft) + int(nodeStyle.marginLeft),\n      top: -node.offsetTop + int(boundNodeStyle.paddingTop) + int(nodeStyle.marginTop),\n      right:\n        innerWidth(boundNode) -\n        outerWidth(node) -\n        node.offsetLeft +\n        int(boundNodeStyle.paddingRight) -\n        int(nodeStyle.marginRight),\n      bottom:\n        innerHeight(boundNode) -\n        outerHeight(node) -\n        node.offsetTop +\n        int(boundNodeStyle.paddingBottom) -\n        int(nodeStyle.marginBottom)\n    }\n  }\n\n  if (isNum(newBounds.right)) newX = Math.min(newX, newBounds.right)\n  if (isNum(newBounds.bottom)) newY = Math.min(newY, newBounds.bottom)\n\n  if (isNum(newBounds.left)) newX = Math.max(newX, newBounds.left)\n  if (isNum(newBounds.top)) newY = Math.max(newY, newBounds.top)\n\n  return [newX, newY]\n}\n\nexport function getContnrolPosition(\n  e: MouseTouchEvent,\n  draggableRef: MutableRefObject<HTMLElement>,\n  touchIndentifier: number,\n  scale: any\n) {\n  const touchObj = typeof touchIndentifier === 'number' ? getTouch(e, touchIndentifier) : null\n  if (typeof touchIndentifier === 'number' && !touchObj) return null\n\n  const node = draggableRef.current\n\n  const offsetParent =\n    draggableRef.current.offsetParent || node.offsetParent || node.ownerDocument.body\n  return offsetFromParent(touchObj || e, offsetParent, scale)\n}\n\nexport function createCoreData(\n  ref: MutableRefObject<any>,\n  state: DraggableState,\n  x: number,\n  y: number\n): DraggableData {\n  const isStart = !isNum(state.lastX)\n  const node = ref.current\n\n  if (isStart) {\n    return {\n      node,\n      deltaX: 0,\n      deltaY: 0,\n      lastX: x,\n      lastY: y,\n      x,\n      y\n    }\n  }\n  return {\n    node,\n    deltaX: x - state.lastX,\n    deltaY: y - state.lastY,\n    lastX: state.lastX,\n    lastY: state.lastY,\n    x,\n    y\n  }\n}\n\nexport function createDraggableData(state: {\n  x: number\n  y: number\n  scale: number\n  coreData: DraggableData\n}) {\n  const { coreData, x, y, scale } = state\n  return {\n    node: coreData.node,\n    x: x + coreData.deltaX / scale,\n    y: y + coreData.deltaY / scale,\n    deltaX: coreData.deltaX / scale,\n    deltaY: coreData.deltaY / scale,\n    lastX: x,\n    lastY: y\n  }\n}\n","import {\n  FC,\n  cloneElement,\n  ReactElement,\n  useRef,\n  useEffect,\n  MutableRefObject,\n  useCallback\n} from 'react'\nimport {\n  matchSelectorAndParent,\n  getTouchIdentifier,\n  addUserSelectStyles,\n  addEvent,\n  removeUserSelectStyle,\n  removeEvent\n} from './utils/dom'\nimport { MouseTouchEvent, DraggableData } from './types'\nimport { getContnrolPosition, createCoreData } from './utils/positions'\nimport { log, snapToGrid, isFunction } from './utils/helpers'\n\nexport interface DragCoreProps {\n  /**\n   * `allowAnyClick allows dragging using any mouse btuton`\n   * Default only accept the left button\n   *\n   * Defaults to `false`\n   */\n  allowAnyClick?: boolean\n  /**\n   * If true, stop the Component from dragging.\n   */\n  disable?: boolean\n  /**\n   * Specifies a selector to be used as the drag handler.\n   */\n  handle?: string\n  cancel?: string\n  enableUserSelect?: boolean\n  scale?: number\n  grid?: [number, number]\n  domRef?: (instance: MutableRefObject<HTMLElement>) => any\n  onMousedown?: (e: MouseEvent) => void\n  /**\n   * Emit when draggable start, if return `false`,\n   * Draggable will stop.\n   */\n  onStart?: (e: MouseEvent, core: DraggableData) => boolean | void\n  /**\n   * Emit when dragging, if return `false`,\n   * Draggable will stop.\n   */\n  onDrag?: (e: MouseEvent, core: DraggableData) => boolean | void\n  onStop?: (e: MouseEvent, core: DraggableData) => boolean | void\n  children: ReactElement\n}\n\nconst events = {\n  mouse: {\n    start: 'mousedown',\n    move: 'mousemove',\n    stop: 'mouseup'\n  },\n  touch: {\n    start: 'touchstart',\n    move: 'touchmove',\n    stop: 'touchend'\n  }\n}\n\nlet dragEvent = events.mouse\n\nconst DragCore: FC<DragCoreProps> = (props) => {\n  const {\n    children,\n    allowAnyClick,\n    disable,\n    handle,\n    cancel,\n    grid,\n    domRef,\n    scale = 1,\n    enableUserSelect = true,\n    onStart = () => 0,\n    onDrag = () => 0,\n    onStop = () => 0,\n    onMousedown = () => 0\n  } = props\n  const stateRef = useRef({\n    lastX: NaN,\n    lastY: NaN,\n    dragging: false,\n    touchIndentifier: null\n  })\n\n  // ref never use as function\n  // const domNode = ref as MutableRefObject<HTMLElement>\n  const domNode = useRef<HTMLElement>(null)\n\n  const handleDragStop = useCallback(\n    (e: MouseTouchEvent) => {\n      const state = stateRef.current\n      if (!state.dragging) return\n\n      const position = getContnrolPosition(e, domNode, state.touchIndentifier, scale)\n      if (position === null) return\n      const { x, y } = position\n      const coreEvent = createCoreData(domNode, state, x, y)\n\n      const shouldContinune = onStop(e, coreEvent)\n      if (shouldContinune === false) return\n\n      if (domNode.current && enableUserSelect) {\n        removeUserSelectStyle(domNode.current.ownerDocument)\n      }\n\n      log('DragCore - handleStop: %j', coreEvent)\n\n      stateRef.current = { ...state, dragging: false, lastX: NaN, lastY: NaN }\n\n      if (domNode) {\n        // eslint-disable-next-line no-use-before-define\n        removeEvent(domNode.current.ownerDocument, dragEvent.move, handleDrag)\n        removeEvent(domNode.current.ownerDocument, dragEvent.stop, handleDragStop)\n      }\n    },\n    [domNode]\n  )\n\n  const handleDrag = useCallback(\n    (e: MouseTouchEvent) => {\n      const state = stateRef.current\n      const position = getContnrolPosition(e, domNode, state.touchIndentifier, scale)\n\n      if (position === null) return\n      let { x, y } = position\n      if (Array.isArray(grid)) {\n        const [deltaX, deltaY] = snapToGrid(grid, x - state.lastX, y - state.lastY)\n        if (!deltaX && !deltaY) return\n        x = state.lastX + deltaX\n        y = state.lastY + deltaY\n      }\n\n      const coreEvent = createCoreData(domNode, state, x, y)\n      log('DragCore - handleDrag: %j', coreEvent)\n\n      // Manually emit the stop event\n      const shouldUpdate = onDrag(e, coreEvent)\n      if (shouldUpdate === false) {\n        // TODO:\n        // Old browser support\n        // @ts-ignore\n        handleDragStop(new MouseEvent('mouseup'))\n        return\n      }\n\n      stateRef.current = { ...state, dragging: true, lastX: x, lastY: y }\n    },\n    [domNode]\n  )\n\n  /**\n   * Handle staring\n   * @param { MouseTouchEvent } e Event\n   */\n  const handleDragStart = useCallback(\n    (e: MouseTouchEvent) => {\n      const state = stateRef.current\n      if (onMousedown) onMousedown(e)\n\n      // Only accept left click from mouse\n      if (!allowAnyClick && e.button !== 0) return\n\n      const node = domNode.current\n      if (!node || !node.ownerDocument || !node.ownerDocument.body) {\n        throw new Error('Draggable not mounted on DragStart')\n      }\n      const { ownerDocument } = node\n\n      // Handle cancel \\ handle \\ disable prop.\n      if (\n        disable ||\n        !(e.target instanceof ownerDocument.defaultView.Node) ||\n        (handle && !matchSelectorAndParent(e.target, handle, node)) ||\n        (cancel && matchSelectorAndParent(e.target, cancel, node))\n      ) {\n        return\n      }\n\n      // Prevent scrolling on mobile device.\n      if (e.type === 'touchstart') e.preventDefault()\n\n      const touchIndentifier = getTouchIdentifier(e)\n      stateRef.current = { ...state, touchIndentifier }\n\n      const position = getContnrolPosition(e, domNode, touchIndentifier, scale)\n      if (position === null) return\n      const { x, y } = position\n\n      const coreEvent = createCoreData(domNode, state, x, y)\n\n      log('DragCore - handleDragStart: %j', coreEvent)\n\n      const shouldUpdate = onStart(e, coreEvent)\n      if (shouldUpdate === false) return\n\n      if (enableUserSelect) addUserSelectStyles(ownerDocument)\n\n      stateRef.current = {\n        ...state,\n        dragging: true,\n        lastX: x,\n        lastY: y\n      }\n\n      addEvent(ownerDocument, dragEvent.move, handleDrag)\n      addEvent(ownerDocument, dragEvent.stop, handleDragStop)\n    },\n    [domNode]\n  )\n\n  const onMouseDown = useCallback((e: MouseTouchEvent) => {\n    dragEvent = events.mouse\n    return handleDragStart(e)\n  }, [])\n\n  const onMouseUp = useCallback((e: MouseTouchEvent) => {\n    dragEvent = events.mouse\n    return handleDragStop(e)\n  }, [])\n\n  const onTouchStart = useCallback((e: MouseTouchEvent) => {\n    dragEvent = events.touch\n    return handleDragStart(e)\n  }, [])\n\n  const onTouchEnd = useCallback((e: MouseTouchEvent) => {\n    dragEvent = events.touch\n    return handleDragStop(e)\n  }, [])\n\n  useEffect(() => {\n    if (domNode) {\n      if (isFunction(domRef)) domRef(domNode)\n      addEvent(domNode.current, events.touch.start, onTouchStart, { passive: false })\n    }\n\n    return () => {\n      if (domNode?.current) {\n        const { ownerDocument } = domNode.current\n        removeEvent(ownerDocument, events.mouse.move, handleDrag)\n        removeEvent(ownerDocument, events.touch.move, handleDrag)\n        removeEvent(ownerDocument, events.mouse.stop, handleDragStop)\n        removeEvent(ownerDocument, events.touch.stop, handleDragStop)\n        removeEvent(domNode.current, events.touch.start, onTouchStart, { passive: false })\n        if (enableUserSelect) removeUserSelectStyle(ownerDocument)\n      }\n    }\n  }, [domNode])\n\n  return cloneElement(children, {\n    ref: domNode,\n    onMouseDown,\n    onMouseUp,\n    onTouchEnd\n  })\n}\n\nexport default DragCore\n","import { useState, useRef, MutableRefObject } from 'react'\n\nexport default function useReferenceState<T>(\n  initialValue: T\n): [MutableRefObject<T>, (value: T) => any, T] {\n  const [state, setState] = useState<T>(initialValue)\n  const reference = useRef<T>(state)\n\n  const setRef = (value: T) => {\n    reference.current = value\n    setState(value)\n  }\n\n  return [reference, setRef, state]\n}\n","/* eslint react/jsx-props-no-spreading: off */\nimport React, {\n  ReactElement,\n  FC,\n  cloneElement,\n  useState,\n  useEffect,\n  useRef,\n  CSSProperties,\n  useCallback\n} from 'react'\nimport classNames from 'classnames'\nimport DragCore, { DragCoreProps } from './DragCore'\nimport {\n  ControlPosition,\n  DraggableEventHandler,\n  BoundsShape,\n  OffsetPositionOfControl\n} from './types'\nimport { log, canDragX, canDragY } from './utils/helpers'\nimport { createDraggableData, getBoundPosition } from './utils/positions'\nimport { createSVGTransform, createCSSTransform } from './utils/dom'\nimport useReferenceState from './hooks/useReferenceState'\n\nexport interface DraggableProps extends DragCoreProps {\n  /**\n   * `axis` determines which axis the draggable can move.\n   * default 'both'\n   */\n  axis?: 'both' | 'x' | 'y'\n\n  className?: string\n  draggingClassName?: string\n  draggedClassName?: string\n\n  /**\n   * Specifies **current** x,y position (include start) when drag end.\n   * Useful for guideline and sticked action.\n   */\n  position?: ControlPosition\n\n  /**\n   * Specifies the x,y position that the drag element should start at\n   */\n  startPosition?: ControlPosition\n  positionOffset?: OffsetPositionOfControl\n  /**\n   * Bounds is the range of movement available to the element.\n   *\n   * ⚠️ Notice that here use `offsetTop` and `offsetLeft` to calcute the bounds.\n   * If use 'parent' or specifies classname,\n   * Add `position` to the parentNode make it run perfectly.\n   */\n  bounds?: BoundsShape | string\n  children: ReactElement\n}\n\nconst Draggable: FC<DraggableProps> = (props) => {\n  const {\n    children,\n    className,\n    draggedClassName,\n    draggingClassName,\n    position,\n    bounds,\n    positionOffset,\n    scale = 1,\n    axis = 'both',\n    startPosition = { x: 0, y: 0 },\n    onStop,\n    onStart,\n    onDrag\n  } = props\n\n  const domNode = useRef<HTMLElement>(null)\n\n  const [stateRef, setState, refState] = useReferenceState({\n    dragging: false,\n    dragged: false,\n    x: position?.x ?? startPosition.x,\n    y: position?.y ?? startPosition.y,\n    prevPropsPos: { ...position },\n    slackX: 0,\n    slackY: 0,\n    isElementSVG: false\n  })\n  const [childProps, setChildProps] = useState({\n    style: { ...children.props.style },\n    className: '',\n    transform: ''\n  })\n\n  // Effects\n  useEffect(() => {\n    if (\n      typeof window.SVGAElement !== 'undefined' &&\n      domNode.current instanceof window.SVGAElement\n    ) {\n      setState({ ...stateRef.current, isElementSVG: true })\n    }\n  }, [domNode])\n\n  useEffect(() => {\n    const state = stateRef.current\n    const controlled = Boolean(position)\n    const draggable = !controlled || state.dragging\n\n    const validatePosition = position || startPosition\n    const transformOpts = {\n      x: canDragX(axis) && draggable ? state.x : validatePosition.x,\n      y: canDragY(axis) && draggable ? state.y : validatePosition.y\n    }\n\n    let svgTransform = null\n    let cssTransform = {}\n    if (state.isElementSVG) {\n      svgTransform = createSVGTransform(transformOpts, positionOffset)\n    } else {\n      cssTransform = createCSSTransform(transformOpts, positionOffset)\n    }\n\n    const classnames = classNames(className || '', children.props.className || '', {\n      [draggedClassName]: state.dragged,\n      [draggingClassName]: state.dragging\n    })\n\n    setChildProps({\n      style: { ...childProps.style, ...cssTransform },\n      className: classnames,\n      transform: svgTransform\n    })\n  }, [refState])\n\n  useEffect(() => {\n    if (position && !stateRef.current.dragging) {\n      const { x, y } = position\n      setState({ ...stateRef.current, x, y })\n    }\n  }, [position])\n\n  // Actions\n  const handleDragStart: DraggableEventHandler = useCallback(\n    (e, coreData) => {\n      const state = stateRef.current\n      log('Draggable: handleDragStart: %j', coreData)\n\n      const sholdStart =\n        onStart && onStart(e, createDraggableData({ x: state.x, y: state.y, scale, coreData }))\n      if (sholdStart === false) return false\n\n      setState({ ...state, dragging: true, dragged: true })\n      return undefined\n    },\n    [stateRef]\n  )\n\n  const handleDrag: DraggableEventHandler = useCallback(\n    (e, coreData) => {\n      const state = stateRef.current\n      if (!state.dragging) return undefined\n\n      log('Draggable: handleDrag: %j', coreData)\n      const uiData = createDraggableData({ x: state.x, y: state.y, scale, coreData })\n\n      const newState: Partial<typeof state> = {\n        x: uiData.x,\n        y: uiData.y\n      }\n\n      if (bounds) {\n        const { x, y } = newState\n\n        newState.x += state.slackX\n        newState.y += state.slackY\n\n        const [newStateX, newStateY] = getBoundPosition(\n          domNode.current,\n          bounds,\n          newState.x,\n          newState.y\n        )\n        newState.x = newStateX\n        newState.y = newStateY\n\n        newState.slackX = state.slackX + (x - newState.x)\n        newState.slackY = state.slackY + (y - newState.y)\n\n        uiData.x = newState.x\n        uiData.y = newState.y\n        uiData.deltaX = newState.x - state.x\n        uiData.deltaY = newState.y - state.y\n      }\n\n      const shouldUpdate = onDrag && onDrag(e, uiData)\n      if (shouldUpdate === false) return false\n\n      setState({ ...state, ...newState })\n      return undefined\n    },\n    [stateRef]\n  )\n\n  const handleDragStop: DraggableEventHandler = useCallback(\n    (e, coreData) => {\n      const state = stateRef.current\n      if (!state.dragging) return undefined\n\n      const shouldContinune = onStop && onStop(e, coreData)\n      if (shouldContinune === false) return false\n\n      log('Draggable: onDragStop: %j', coreData)\n\n      const newState: Partial<typeof state> = {\n        dragging: false,\n        slackX: 0,\n        slackY: 0\n      }\n\n      setState({ ...state, ...newState })\n      return undefined\n    },\n    [stateRef]\n  )\n\n  return (\n    <DragCore\n      {...{ ...props, onStart: handleDragStart, onDrag: handleDrag, onStop: handleDragStop }}\n      domRef={(instace) => {\n        domNode.current = instace.current\n      }}\n    >\n      {cloneElement(children, {\n        ...childProps\n      })}\n    </DragCore>\n  )\n}\n\nexport default Draggable\n"],"names":["find","array","cb","Array","isArray","undefined","i","length","apply","isFunction","func","Object","prototype","toString","call","isNum","number","Number","isNaN","int","parseInt","snapToGrid","grid","pendingX","pendingY","x","Math","round","y","canDragX","axis","canDragY","log","process","env","NODE_ENV","console","prefixes","kebabToTitleCase","str","value","shouldCapitalize","toUpperCase","browserPrefixToKey","prop","prefix","getPrefix","window","document","style","documentElement","addClass","el","classname","classList","add","className","match","RegExp","removeClass","remove","replace","addEvent","event","handler","inputOptions","options","capture","addEventListener","attachEvent","removeEvent","removeEventListener","detachEvent","matchsSelectorFunc","matchSelector","selector","method","matchSelectorAndParent","baseNode","node","parentNode","getTouch","e","indentifier","targetTouches","t","changedTouches","getTouchIdentifier","identifier","offsetFromParent","offsetParent","scale","clientX","clientY","isBody","ownerDocument","body","rect","left","top","getBoundingClientRect","scrollLeft","scrollTop","addUserSelectStyles","doc","styleEl","getElementById","createElement","setAttribute","id","innerHTML","getElementsByTagName","appendChild","removeUserSelectStyle","selection","getSelection","empty","defaultView","type","removeAllRanges","outerWidth","width","clientWidth","computedStyle","getComputedStyle","borderLeftWidth","borderRightWidth","outerHeight","height","clientHeight","borderTopWidth","borderBottomWidth","innerWidth","paddingLeft","paddingRight","innerHeight","paddingTop","paddingBottom","getTranslation","positionOffset","unit","translation","defaultX","defaultY","createCSSTransform","controlPos","browserPrefix","createSVGTransform","cloneBounds","bounds","right","bottom","getBoundPosition","newX","newY","newBounds","ownerWindow","boundNode","querySelector","HTMLElement","Error","nodeStyle","boundNodeStyle","offsetLeft","marginLeft","offsetTop","marginTop","marginRight","marginBottom","min","max","getContnrolPosition","draggableRef","touchIndentifier","touchObj","current","createCoreData","ref","state","isStart","lastX","deltaX","deltaY","lastY","createDraggableData","coreData","events","mouse","start","move","stop","touch","dragEvent","DragCore","props","children","allowAnyClick","disable","handle","cancel","domRef","enableUserSelect","onStart","onDrag","onStop","onMousedown","stateRef","useRef","NaN","dragging","domNode","handleDragStop","useCallback","position","coreEvent","shouldContinune","handleDrag","shouldUpdate","MouseEvent","handleDragStart","button","target","Node","preventDefault","onMouseDown","onMouseUp","onTouchStart","onTouchEnd","useEffect","passive","cloneElement","useReferenceState","initialValue","useState","setState","reference","setRef","Draggable","draggedClassName","draggingClassName","startPosition","dragged","prevPropsPos","slackX","slackY","isElementSVG","refState","transform","childProps","setChildProps","SVGAElement","controlled","Boolean","draggable","validatePosition","transformOpts","svgTransform","cssTransform","classnames","classNames","sholdStart","uiData","newState","newStateX","newStateY","instace"],"mappings":"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"}